<!DOCTYPE html>
<html>
<head>
    <title>Clients information page</title>

    <link href="css/examples-offline.css" rel="stylesheet">
    <link href="http://cdn.kendostatic.com/2012.2.913/styles/kendo.common.min.css" rel="stylesheet">
    <link href="http://cdn.kendostatic.com/2012.2.913/styles/kendo.metro.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://cdn.kendostatic.com/2012.2.913/js/kendo.web.min.js"></script>
    <script src="js/vendor/console.js"></script>
</head>
<body>
<div id="example">
    <div id="grid" autofocus></div>

    <script type="text/x-kendo-template" id="template">
        <div class="tabstrip">
            <ul>
                <li class="k-state-active">
                    Company information
                </li>
                <li>
                    Address
                </li>
                <li>
                    Payment information
                </li>
            </ul>
            <div>
                <div class="company-information">
                    <!--<label>Name:</label>#: Name #<br>-->
                    <label class="k-label">Name:</label><input type="text" data-bind="value: Name" class="k-input"/><br>
                    <label>Registration number:</label>#: RegistrationNumber #<br>
                    <label>Role:</label>#: Role #<br>
                    <label>KMKR number:</label>#: KMKR #<br>
                    <label>Client agreement number:</label>#: AgreementNumber #<br>
                    <label>Contact person:</label>#: ContactPerson.Name #<br>
                    <label>Contact email:</label>#: ContactPerson.Email #<br>
                    <label>Contact mobile number:</label>#: ContactPerson.Phone #<br>
                    <label>Contact fax number:</label>#: ContactFax #<br>
                    <label>Comments:</label>#: Comments #<br>
                </div>
            </div>
            <div>
                <div class="address">
                    <label>Street:</label>#: Address.Street #<br>
                    <label>City:</label>#: Address.City #<br>
                    <label>Zip:</label>#: Address.Zip #<br>
                    <label>State:</label>#: Address.State #<br>
                    <label>Country:</label>#: Address.Country #<br>
                </div>
            </div>
            <div>
                <div class='payment-details'>
                    <label>Bills payment delay:</label>#: Payment.Days #<br>
                    <label>Bank name:</label>#: Payment.Bank #<br>
                    <label>Bank account number:</label>#: Payment.Account #<br>
                    <label>Transaction reference number:</label>#: Payment.ReferenceNumber #<br>
                </div>
            </div>
        </div>

    </script>

    <script>
        var clients = [ {
            "ClientID": 1,
            "Name": "OOO Almazi",
            "RegistrationNumber": "1234567890",
            "KMKR": "RU0013232",
            "AgreementNumber": "34",
            "Address": {
                "Street": "Prospekt Lenina 13-7",
                "Zip": "11978",
                "State": "",
                "City": "Moscow",
                "CountryID": 4,
                "Country": "Russia" // TODO - fix me. Modify template to take ID and calculate country name from it
            },
            "RoleID": 1,
            "Role": "Buyer",
            "ContactPerson": {
                "Name": "Vladimir Metrov",
                "Email": "vmetrov@almazi.ru",
                "Phone": "8701190002"
            },
            "ContactFax": "",
            "Payment": {
                "Days": 30,
                "Bank": "VTB",
                "Account": "1803782290",
                "ReferenceNumber": "17720"
            },
            "Comments": "Very aggressive negotiator"
        }, {
            "ClientID": 2,
            "Name": "Kilka OU",
            "RegistrationNumber": "8821100987",
            "KMKR": "EE0089119",
            "AgreementNumber": "2",
            "Address": {
                "Street": "Liiavalaia 11-8",
                "Zip": "13089",
                "State": "Harjumaa",
                "City": "Tallinn",
                "CountryID": 1,
                "Country": "Estonia"
            },
            "RoleID": 2,
            "Role": "Receiver",
            "ContactPerson": {
                "Name": "Mihkel Pihkel",
                "Email": "mihkel@kilka.ee",
                "Phone": "3725012078"
            },
            "ContactFax": "",
            "Payment": {
                "Days": 14,
                "Bank": "Swedbank",
                "Account": "22109911889",
                "ReferenceNumber": "00911"
            },
            "Comments": "Like to delay payment"
        }];

        var countries = [{
            "value": 1,
            "text": "Estonia"
        },{
            "value": 2,
            "text": "Latvia"
        },{
            "value": 3,
            "text": "Lithuania"
        },{
            "value": 4,
            "text": "Russia"
        },{
            "value": 5,
            "text": "Germany"
        }];

        var clientRoles = [{
           "value": 1,
           "text": "Buyer"
        }, {
            "value": 2,
            "text": "Receiver"
        }, {
            "value": 3,
            "text": "Transporter"
        }, {
            "value": 4,
            "text": "TIR provider"
        }];

        $(document).ready(function() {
            var dataSource = new kendo.data.DataSource({
                pageSize: 30,
                data: clients,
                autoSync: true,
                schema: {
                    model: {
                        id: "ClientID",
                        fields: {
                            ClientID: { editable: false, type: "number", nullable: false },
                            Name: { validation: { required: true } },
                            AddressCountry: { field: "Address.CountryID", defaultValue: 1 },
                            PaymentDays: { field: "Payment.Days", type: "number", validation: { required: true, min: 1} }
                        }
                    }
                }
            });

            $("#grid").kendoGrid({
                dataSource: dataSource,
                pageable: true,
                height: 600,
                sortable: {
                    mode: "multiple",
                    allowUnsort: true
                },
                resizable: true,
                reorderable: true,
                selectable: "row",
                navigatable: true,
                detailTemplate: kendo.template($("#template").html()),
                detailInit: detailInit,
                dataBound: function() {
                    this.expandRow(this.tbody.find("tr.k-master-row").first());
                },
                toolbar: [{ name: "create", text: "Add new company" }, "save"],
                columns: [
                    { field: "Name", title:"Client name", width: "200px", headerAttributes: { style: "text-align: center" } },
                    { field: "Address.Street", title: "Address", headerAttributes: { style: "text-align: center" }, width: "250px" },
                    { field: "Address.CountryID", title:"Country", width: "150px", values: countries, headerAttributes: { style: "text-align: center" }  },
                    { field: "RoleID", title:"Role", width: "100px", values: clientRoles, headerAttributes: { style: "text-align: center" }  },
                    { field: "Payment.Days", title:"Payment delay", format: "{0}", width: "100px", headerAttributes: { style: "text-align: center" }  },
                    { command: ["destroy"], title: " ", width: "180px" }],
                editable: {
                    mode: "incell",
                    confirmation: "Are you sure you want to remove this company?"
                },
                remove: function(e) {
                    console.log("Item deleted: " + e.row);
                },
                saveChanges: function(e) {
                    console.log("Save called: " + JSON.stringify(e.values));
                }
            });

            var grid = $("#grid").data("kendoGrid");
            grid.select(grid.tbody.find(">tr:first"));

            grid.bind("edit", function (e) {
                e.container.find("input").select();
            });
        });

        function detailInit(e) {
            var detailRow = e.detailRow;

            detailRow.find(".tabstrip").kendoTabStrip({
                animation: {
                    open: { effects: "fadeIn" }
                }
            });
        }

    </script>
</div>

</body>
</html>
