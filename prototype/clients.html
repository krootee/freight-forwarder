<!DOCTYPE html>
<html>
<head>
    <title>Editing custom editor</title>

    <link href="css/examples-offline.css" rel="stylesheet">
    <link href="css/kendo.common.min.css" rel="stylesheet">
    <link href="css/kendo.metro.min.css" rel="stylesheet">

    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/kendo.web.min.js"></script>
    <script src="js/vendor/console.js"></script>
</head>
<body>
<div id="example" class="k-content">
    <div id="grid"></div>

    <script type="text/x-kendo-template" id="template">
        <div class="tabstrip">
            <ul>
                <li class="k-state-active">
                    Company information
                </li>
                <li>
                    Address
                </li>
                <li>
                    Payment information
                </li>
            </ul>
            <div>
                <div class="company-information">
                    <label>Name:</label>#= Name #<br>
                    <label>Registration number:</label>#= RegistrationNumber #<br>
                    <label>KMKR number:</label>#= KMKR #<br>
                    <label>Client agreement number:</label>#= AgreementNumber #<br>
                    <label>Contact person:</label>#= ContactPersonName #<br>
                    <label>Contact email:</label>#= ContactPersonEmail #<br>
                    <label>Contact mobile number:</label>#= ContactPersonPhone #<br>
                    <label>Contact fax number:</label>#= ContactPersonFax #<br>
                    <label>Comments:</label>#= Comments #<br>
                </div>
            </div>
            <div>
                <div class="address">
                    <label>Street:</label>#= AddressStreet #<br>
                    <label>City:</label>#= AddressCity #<br>
                    <label>Zip:</label>#= AddressZip #<br>
                    <label>State:</label>#= AddressState #<br>
                    <label>Country:</label>#= AddressCountry #<br>
                </div>
            </div>
            <div>
                <div class='payment-details'>
                    <label>Bills payment delay:</label>#= PaymentDays #<br>
                    <label>Bank name:</label>#= PaymentBank #<br>
                    <label>Bank account number:</label>#= PaymentAccount #<br>
                    <label>Transaction reference number:</label>#= PaymentReferenceNumber #<br>
                </div>
            </div>
        </div>

    </script>

    <script>
        var clients = [ {
            "ClientID": 1,
            "Name": "OOO Almazi",
            "RegistrationNumber": "1234567890",
            "KMKR": "RU0013232",
            "AgreementNumber": "34",
            "AddressStreet": "Prospekt Lenina 13-7",
            "AddressZip": "11978",
            "AddressState": "",
            "AddressCity": "Moscow",
            "AddressCountryID": 4,
            "AddressCountry": "Russia", // TODO - fix me. Modify template to take ID and calculate country name from it
            "ContactPersonName": "Vladimir Metrov",
            "ContactPersonEmail": "vmetrov@almazi.ru",
            "ContactPersonPhone": "8701190002",
            "ContactPersonFax": "",
            "PaymentDays": 30,
            "PaymentBank": "VTB",
            "PaymentAccount": "1803782290",
            "PaymentReferenceNumber": "17720",
            "Comments": "Very aggressive negotiator"
        }, {
            "ClientID": 2,
            "Name": "Kilka OU",
            "RegistrationNumber": "8821100987",
            "KMKR": "EE0089119",
            "AgreementNumber": "2",
            "AddressStreet": "Liiavalaia 11-8",
            "AddressZip": "13089",
            "AddressState": "Harjumaa",
            "AddressCity": "Tallinn",
            "AddressCountryID": 1,
            "AddressCountry": "Estonia",
            "ContactPersonName": "Mihkel Pihkel",
            "ContactPersonEmail": "mihkel@kilka.ee",
            "ContactPersonPhone": "3725012078",
            "ContactPersonFax": "",
            "PaymentDays": 14,
            "PaymentBank": "Swedbank",
            "PaymentAccount": "22109911889",
            "PaymentReferenceNumber": "00911",
            "Comments": "Like to delay payment"
        }];

        var countries = [{
            "value": 1,
            "text": "Estonia"
        },{
            "value": 2,
            "text": "Latvia"
        },{
            "value": 3,
            "text": "Lithuania"
        },{
            "value": 4,
            "text": "Russia"
        },{
            "value": 5,
            "text": "Germany"
        }];

        $(document).ready(function() {
            var dataSource = new kendo.data.DataSource({
                pageSize: 30,
                data: clients,
                autoSync: true,
                schema: {
                    model: {
                        id: "ClientID",
                        fields: {
                            ClientID: { editable: false, nullable: false },
                            Name: { validation: { required: true } },
                            AddressCountry: { field: "AddressCountryID" },
                            PaymentDays: { type: "number", validation: { required: true, min: 1} }
                        }
                    }
                }
            });

            $("#grid").kendoGrid({
                dataSource: dataSource,
                pageable: true,
                height: 600,
                sortable: {
                    mode: "multiple",
                    allowUnsort: true
                },
                resizable: true,
                reorderable: true,
                selectable: "row",
                detailTemplate: kendo.template($("#template").html()),
                detailInit: detailInit,
                dataBound: function() {
                    this.expandRow(this.tbody.find("tr.k-master-row").first());
                },
                toolbar: [{ name: "create", text: "Add new company" }, "save"],
                columns: [
                    { field: "Name", title:"Client name", width: "200px", headerAttributes: { style: "text-align: center" } },
                    { field: "AddressStreet", title: "Address", headerAttributes: { style: "text-align: center" }, width: "250px" },
                    { field: "AddressCountryID", title:"Country", width: "150px", values: countries, headerAttributes: { style: "text-align: center" }  },
                    { field: "PaymentDays", title:"Payment delay", format: "{0}", width: "100px", headerAttributes: { style: "text-align: center" }  },
                    { field: "RegistrationNumber", width: "150px" },
                    { command: ["edit", "destroy"], title: " ", width: "180px" }],
                editable: {
                    mode: "popup",
                    confirmation: "Are you sure you want to remove this company?"
                },
                remove: function(e) {
                    console.log("Item deleted: " + e.row);
                },
                saveChanges: function(e) {
                    console.log("Save called: " + JSON.stringify(e.values));
                }
            });

            var grid = $("#grid").data("kendoGrid");
            grid.hideColumn("RegistrationNumber");
            grid.select(grid.tbody.find(">tr:first"));
        });

        function detailInit(e) {
            var detailRow = e.detailRow;

            detailRow.find(".tabstrip").kendoTabStrip({
                animation: {
                    open: { effects: "fadeIn" }
                }
            });
        }

    </script>
</div>

</body>
</html>
