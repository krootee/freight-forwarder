<!DOCTYPE html>
<html>
<head>
    <title>Deals summary page</title>

    <link href="css/examples-offline.css" rel="stylesheet">
    <link href="http://cdn.kendostatic.com/2012.2.913/styles/kendo.common.min.css" rel="stylesheet">
    <link href="http://cdn.kendostatic.com/2012.2.913/styles/kendo.metro.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://cdn.kendostatic.com/2012.2.913/js/kendo.web.min.js"></script>
    <script src="js/vendor/console.js"></script>
    <script src="data/defaults.js" type="text/javascript"></script>
</head>
<body>
<div id="main">
    <div id="controlButtons">
        <button id="addNew" class="k-button" onclick="addDeal()">Add new deal</button>
        <button id="editDeal" class="k-button" onclick="toolbarEditDeal()">Edit deal</button>
    </div>
    <div id="grid" autofocus></div>

    <script>
        function addDeal() {
            console.log("add new record");
            location.href='tehing.html?id=4';
        }

        function toolbarEditDeal() {
            var grid = $("#grid").data("kendoGrid");
            var item = grid.dataItem(grid.select());

            console.log("edit record " + item.id.toString());
            editDeal(item.id);
        }

        function editDeal(pageId) {
            console.log("edit record " + pageId.toString());
            location.href='tehing.html?id=' + pageId.toString();
        }

        $(document).ready(function() {
            var dataSource = new kendo.data.DataSource({
                pageSize: 30,
                data: FR.deals,
                autoSync: true,
                schema: {
                    model: {
                        id: "dealId",
                        fields: {
                            dealId: { editable: false, type: "number", nullable: false }
                        }
                    }
                },
            });

            $("#grid").kendoGrid({
                dataSource: dataSource,
                pageable: true,
                height: 600,
                sortable: {
                    mode: "multiple",
                    allowUnsort: true
                },
                resizable: true,
                reorderable: true,
                selectable: "row",
                navigatable: true,
                columns: [
                    { field: "dealId", title:"ID", width: "100px", headerAttributes: { style: "text-align: center" } },
                    { field: "date", title:"Transaction date", width: "200px", headerAttributes: { style: "text-align: center" } },
                    { field: "clientName", title:"Client", width: "200px", headerAttributes: { style: "text-align: center" } },
                    { field: "merchandise", title:"Merchandise", width: "200px", headerAttributes: { style: "text-align: center" } },
                    { field: "lastModified", title:"Last modification", width: "200px", headerAttributes: { style: "text-align: center" } },
                    { command: ["destroy"], title: " ", width: "180px" }],
                editable: {
                    update: false,
                    destroy: true
                },
                remove: function(e) {
                    console.log("Item deleted: " + e.row);
                }
            });

            var grid = $("#grid").data("kendoGrid");
            grid.select(grid.tbody.find(">tr:first"));

            $('#grid tr').dblclick(function() {
                editDeal($(this).find('td:first').text());
            });
        });
    </script>
</div>

</body>
</html>
